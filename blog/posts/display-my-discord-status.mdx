---
title: å®æ—¶è¯»å–è‡ªå·±çš„ Discord çŠ¶æ€ï¼Œä¾›å‰ç«¯åº”ç”¨å±•ç¤º
date: 2025-11-14
updated: 2025-11-20
banner: ./display-my-discord-status/banner.jpg
categories:
  - åç«¯å¼€å‘
tags:
  - Discord
  - Bot
  - Python
  - FastAPI
---

ç¬”è€…æ€§æ ¼ä½¿ç„¶ï¼Œå¹¶ä¸å¤ªä»‹æ„ä¸ªäººéšç§ï¼Œæ„¿æ„æŠŠè‡ªå·±çš„å„ç§è¿›è¡Œæ—¶çš„çŠ¶æ€ä¿¡æ¯å…¬å¼€å±•ç¤ºåœ¨ä¸ªäººç½‘ç«™ä¸Šã€‚å¾ˆæ—©ä»¥å‰ï¼Œç¬”è€…å°±æƒ³è¦å®ç°ä¸€ä¸ªå°è½¯ä»¶ï¼Œå®ƒèƒ½è‡ªåŠ¨è¯»å–åœ¨ç”µè„‘ä¸Šè¿è½¬çš„ç¨‹åºï¼Œå°†å½“å‰æ´»è·ƒçš„ç¨‹åºåç§°ä¸Šä¼ åˆ°ç½‘ç«™ä¸Šè¿›è¡Œå±•ç¤ºã€‚ä½†æ˜¯é—æ†¾æ²¡æœ‰å¥½çš„å®ç°æ€è·¯ï¼Œæœ€ç»ˆåªæ˜¯æ–°å»ºäº† Repo å°±æç½®äº†è¿™ä¸ªæƒ³æ³•ã€‚

å¦‚ä»Šï¼Œéšç€å…¨å±€ä»£ç†æˆä¸ºå®¶ä¸­ç½‘ç»œæ ‡é…ï¼ŒDiscord æˆä¸ºæŒ‚é©»åå°çš„å¸¸ç”¨è½¯ä»¶ï¼Œçœ‹ç€è‡ªå·±ä¿¡æ¯é¡µçš„â€œæ­£åœ¨ç©â€é¡¹ç›®ï¼Œå¿ƒæƒ³è¿™ä¸å°±æ˜¯ç¬”è€…ä¸€ç›´æƒ³è¦çš„è¯»å–è‡ªå·±åœ¨åšä»€ä¹ˆçš„åŠŸèƒ½å—ï¼Ÿé‚£ä¹ˆï¼Œç°åœ¨å†å»åšè¿™ä¸ªè½¯ä»¶å°±ç®€å•ä¸å°‘äº†ï¼šåªéœ€è¦å®ç°è¯»å–è‡ªå·±çš„ Discord çŠ¶æ€ï¼Œå¼€æ”¾æ¥å£ä¾›å‰ç«¯è°ƒç”¨å°±å¥½äº†ã€‚

ç»è¿‡è°ƒç ”ï¼Œç¬”è€…æ‰¾åˆ°äº† [`discord.py-self`](https://github.com/dolfies/discord.py-self) åº“ï¼Œè€ƒè™‘é€šè¿‡ Discord Self-Bot æ¥å®ç°ç›¸å…³åŠŸèƒ½ã€‚**å½“ç„¶ï¼Œç›´æ¥è½®è¯¢è°ƒç”¨ Discord å®˜æ–¹æä¾›çš„ API å·²ç„¶å¯ä»¥å®ç°éœ€æ±‚ï¼Œåªæ˜¯ç¬”è€…å¤ªé—²äº†æƒ³åœ¨å¤–é¢åŒ…ä¸€å±‚ Self-Bot**â€¦â€¦ğŸ˜ä¸‡ä¸€ä»¥åç”¨å¾—ä¸Šå‘¢ï¼Ÿ

> Discord å®˜æ–¹æ–‡æ¡£ä¸­æ˜ç¡®è¡¨ç¤º**ä¸æ”¯æŒ Self-Bot çš„ä½¿ç”¨**ï¼Œè¿åä½¿ç”¨æ¡æ¬¾å¯èƒ½å¯¼è‡´è´¦å·è¢«å°ç¦ã€‚å› æ­¤ï¼Œç¬”è€…ä»…å°†æœ¬æ–‡å†…å®¹ä½œä¸ºæŠ€æœ¯åˆ†äº«ï¼Œè‹¥æ‚¨å†³å¿ƒå®ç°ç±»ä¼¼åŠŸèƒ½ï¼Œè¯·æ‰¿æ‹…è´¦å·å°ç¦çš„é£é™©ã€‚

æ•´ä¸ªæ­¥éª¤ç®€å•æ¥è¯´å°±æ˜¯ï¼šåˆ›å»ºä¸€ä¸ª Bot å­è´¦å·ï¼Œæ·»åŠ ä¸»è´¦å·å¥½å‹ï¼Œè®© Bot è½®è¯¢ä¸»è´¦å·çš„çŠ¶æ€ä¿¡æ¯ï¼Œå°†å…¶æä¾›ç»™å‰ç«¯è®¿é—®ã€‚å³ä½¿çœŸçš„è§¦åˆ°éœ‰å¤´è¢«å®˜æ–¹å°ç¦çš„è¯ï¼Œå»ä¸–çš„ä¹Ÿåªæ˜¯å­è´¦å·â€¦â€¦å§ã€‚

## å®ç°è¯»å–è‡ªå·± Discord çŠ¶æ€çš„ Self-Bot

è™½è¯´ç¨‹åºå‘˜ä¸è¯¥è‡ªå·±è®¾é™ï¼Œä½†æ¯•ç«Ÿæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ Python ä»é›¶å¼€å§‹æ“ä¸€ä¸ªé¡¹ç›®ï¼Œä»ç¯å¢ƒæ­å»ºåˆ°åº”ç”¨éƒ¨ç½²ä¸Šçº¿ï¼Œéƒ½ä¸å­˜åœ¨è‡ªå·±çš„æ–¹æ³•è®ºæˆ–æœ€ä½³å®è·µï¼Œå› æ­¤æœ¬ç« èŠ‚çš„å®ç°è¿‡ç¨‹ä»…ä¾›å‚è€ƒï¼Œå¦‚æœ‰æ›´å¥½çš„æ–¹æ¡ˆä¹Ÿè¯·ä¸åç•™è¨€æŒ‡å‡ºã€‚ä¹Ÿå› ä¸ºæ˜¯ä»é›¶å¼€å§‹ï¼Œæœ¬ç« èŠ‚çš„è¿‡ç¨‹ä»‹ç»ä¼šæ¯”è¾ƒå•°å—¦ï¼Œæƒå½“ç•™ç»™è‡ªå·±æ—¥åç¿»é˜…å§ã€‚

### å¼€å‘ç¯å¢ƒæ­å»ºä¸å‰ç½®å‡†å¤‡

ç›®å‰ discord.py-self åº“ä¿è¯å…¼å®¹çš„æœ€é«˜ Python ç‰ˆæœ¬ä¸º `3.12`ã€‚ç¬”è€…å›æƒ³èµ·ç®¡ç† Node.js ç‰ˆæœ¬æ—¶ä½¿ç”¨ `nvm` çš„ç»éªŒï¼Œæ–™æƒ³ Python ä¹Ÿåº”è¯¥æœ‰ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œæœç„¶æ‰¾åˆ°äº†å¤§å®¶å¸¸ç”¨çš„ [`pyenv`](https://github.com/pyenv/pyenv) å·¥å…·ï¼Œå¯¹äº Windows ç«¯å®ƒæ˜¯ [`pyenv-win`](https://github.com/pyenv-win/pyenv-win)ã€‚

å‚è€ƒå®˜æ–¹æ–‡æ¡£å®‰è£… `pyenv`ï¼Œä½¿ç”¨å®ƒå®‰è£…å¹¶ç®¡ç†æœ¬æœºçš„ Python ç‰ˆæœ¬ï¼š

```bash
# å®‰è£…æŒ‡å®šçš„ Python ç‰ˆæœ¬
pyenv install 3.12
# è®¾ç½®å…¨å±€ Python ç‰ˆæœ¬
pyenv global 3.12
# éªŒè¯ Python ç¯å¢ƒ
python -c "import sys; print(sys.executable)"
```

ä¸åŒäº Node.js åœ¨å®‰è£…ä¾èµ–æ—¶ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆ `node_modules` æ–‡ä»¶å¤¹ï¼Œåœ¨ Python é¡¹ç›®é‡Œï¼Œå¤§å®¶ä¸€èˆ¬ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»é¡¹ç›®ä¾èµ–ã€‚ç¬”è€…æ‰¾åˆ°äº†ç”¨äº Python é¡¹ç›®çš„ä¾èµ–ç®¡ç†å·¥å…· `pipenv`ï¼Œä½¿ç”¨å®ƒçš„ä½“éªŒå‡ ä¹ä¸ Node.js ç®¡ç†ä¾èµ–æ— å¼‚ï¼Œéå¸¸ Niceã€‚

åœ¨ç³»ç»Ÿä¸Šå®‰è£… `pipenv`ï¼š

```bash
# è®¾ç½®é•œåƒæºä¸ºæ¸…åå¤§å­¦é•œåƒ
pip config set global.index-url https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple
# å…¨å±€å®‰è£… pipenv
pip install pipenv
```

å› ä¸º `pyenv` å’Œ `pipenv` é•¿å¾—å¾ˆåƒï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å¼„æ··ã€‚ç®€å•æ¥è¯´ï¼Œ`pyenv` æ˜¯ç”¨æ¥ç®¡ç† Python ç‰ˆæœ¬çš„ï¼Œè€Œ `pipenv` æ˜¯ç”¨æ¥ç®¡ç†é¡¹ç›®ä¾èµ–çš„ã€‚é™¤äº†ä¸€å¼€å§‹è®¾ç½®å…¨å±€ Python ç‰ˆæœ¬æ—¶ä¼šç”¨åˆ° `pyenv`ï¼Œåç»­é¡¹ç›®å¼€å‘æ—¶å¯¹è™šæ‹Ÿç¯å¢ƒå’Œä¾èµ–çš„ç®¡ç†éƒ½åªéœ€è¦ä½¿ç”¨ `pipenv`ã€‚

å¦‚æœæœ€æ—©å­¦ä¹ å‰ç«¯æ—¶ï¼Œç¬”è€…å°±çŸ¥é“ä»æ¡†æ¶å¼€å§‹æ„å»ºé¡¹ç›®ï¼Œæƒ³å¿…èƒ½èŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚å½“ç„¶ç¬”è€…å¹¶ä¸åæ‚”ï¼Œæ¯•ç«Ÿæ¡†æ¶çœç•¥çš„éƒ¨åˆ†ä¹Ÿæ˜¯æ„æˆå‰ç«¯æŠ€æœ¯æ ˆçš„é‡è¦ä¸€æ”¯ï¼Œç»•å¼¯è·¯å­¦ä¹ å®ƒä»¬ä½•å°ä¸æ˜¯ä¸€ç§å¢è¿›æŠ€æœ¯çš„æ·å¾„ã€‚ä¸è¿‡å¯¹äº Python è€Œè¨€ï¼Œè‡ªè§‰ç°åœ¨ä¸æ„¿ä»˜å‡ºé‚£ä¹ˆå¤šå¿ƒè¡€å»ç²¾è¿›ï¼Œå› æ­¤å³åˆ»é€‰æ‹©ä»æ¡†æ¶å…¥æ‰‹ï¼Œå¿«é€Ÿæ­å»ºèµ·é¡¹ç›®çš„é›å½¢ã€‚é€‚åˆæ„å»ºè½»é‡çº§ Web æœåŠ¡çš„ Python æ¡†æ¶æœ‰å¾ˆå¤šï¼Œä»¥ Github æ˜Ÿæ ‡æ•°ä¸ºå¯¼å‘ï¼Œè¿™é‡Œé€‰æ‹©äº† [FastAPI](https://github.com/fastapi/fastapi) ä½œä¸ºå¼€å‘æ¡†æ¶ã€‚

å‚è€ƒ FastAPI æ–‡æ¡£ï¼Œå®‰è£…ä¾èµ–åº“ï¼š

```bash
# æ‰§è¡Œå‘½ä»¤åä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ `Pipfile` å’Œ `Pipfile.lock` æ–‡ä»¶
pipenv install fastapi "uvicorn[standard]"
```

ä»£ç æ ¼å¼åŒ–å’Œè´¨é‡æ£€æŸ¥å·¥å…·å¯¹äºä¸€ä¸ªå¥åº·çš„ä»£ç åº“æ˜¯å¿…ä¸å¯å°‘ï¼Œç¬”è€…é€‰ç”¨äº†å¼€æºç¤¾åŒºæ–°å®  [`ruff`](https://github.com/astral-sh/ruff)ï¼š

```bash
pipenv install --dev ruff
```

å¦å¤–é…åˆ [VSCode æ’ä»¶ Ruff](https://marketplace.visualstudio.com/items?itemName=charliermarsh.ruff) å’Œ Python åº“ [`pre-commit`](https://pre-commit.com/)ï¼Œå¯ä»¥å®ç°å®Œå¤‡çš„ä»£ç è´¨é‡æ£€æŸ¥å’Œæ ¼å¼åŒ–åŠŸèƒ½ï¼Œä¸å†èµ˜è¿°ã€‚

æœ€åï¼Œè¿›å…¥ `pipenv` åˆ›å»ºå¥½çš„è™šæ‹Ÿç¯å¢ƒï¼š

```bash
pipenv shell
```

å¦‚æœ VSCode æç¤ºâ€œæ— æ³•è§£æå¯¼å…¥æ¨¡å—â€ï¼Œå¯ä»¥æŒ‰ `Ctrl+Shift+P`ï¼Œè¾“å…¥å¹¶é€‰æ‹© `Python: Select Interpreter`ï¼Œç„¶åæ‰‹åŠ¨é€‰æ‹© `pipenv` åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒè·¯å¾„ä½œä¸ºè§£é‡Šå™¨ã€‚

è¿™æ ·ï¼Œå¼€å‘åº”ç”¨è¦ç”¨åˆ°çš„ Python ç¯å¢ƒå°±ç®—æ­å»ºå®Œæ¯•äº†ã€‚æœªæ¥åˆ‡æ¢ä¸åŒçš„æœºå™¨å¼€å‘æ—¶ï¼Œä¹Ÿä¸ç”¨ä¸º Python ç‰ˆæœ¬å’Œä¾èµ–åŒ…è€Œçƒ¦æ¼ã€‚

### è¿æ¥åˆ° Discord

æ¥ä¸‹æ¥ï¼Œæ­£å¼å¼€å§‹å¼€å‘æœåŠ¡ç«¯åº”ç”¨ã€‚æœ€åŸºæœ¬çš„ä»»åŠ¡å°±æ˜¯è¿æ¥åˆ° Discord è´¦å·ã€‚

å®‰è£…ä¾èµ–åŒ… `discord.py-self`ï¼š

```bash
pipenv install discord.py-self
```

ç»“åˆ FastAPI çš„æ–‡æ¡£å’Œ `discord.py-self` çš„ä»“åº“ç¤ºä¾‹ï¼Œåœ¨ AI çš„å¸®åŠ©ä¸‹å®ç°è¿æ¥ Discord è´¦å·çš„åŠŸèƒ½ï¼š

```python
# main.py
import asyncio
import os

import discord
import uvicorn
from dotenv import load_dotenv
from fastapi import FastAPI

load_dotenv()


class MyClient(discord.Client):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

    async def on_ready(self):
        print(f"âœ… Discord Bot Logged in as {self.user}")


client = MyClient()


async def run_discord_bot():
    await client.start(os.getenv("DISCORD_TOKEN"))


async def lifespan(app: FastAPI):
    print("ğŸš€ Starting Discord Bot...")
    task = asyncio.create_task(run_discord_bot())
    yield

    print("ğŸ›‘ Shutting down...")
    if not client.is_closed():
        await client.close()
        print("ğŸŒ™ Discord bot connection was closed.")
    task.cancel()


app = FastAPI(lifespan=lifespan)


if __name__ == "__main__":
    uvicorn.run(
        "main:app", host="0.0.0.0", port=28800, reload=True
    )
```

ä»ç¯å¢ƒå˜é‡é‡Œè·å–çš„ `DISCORD_TOKEN` æ˜¯ Bot å­è´¦å·çš„ `authorization` å­—æ®µå€¼ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œä»ç½‘ç»œè¯·æ±‚å¤´ä¸­è·å–ã€‚

ä½¿ç”¨ `python main.py` å‘½ä»¤è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå¦‚æœæ§åˆ¶å°æ‰“å°å‡º `âœ… Discord Bot Logged in as <username>`ï¼Œè¯´æ˜æˆåŠŸè¿æ¥åˆ° Discordã€‚

### è¯»å–ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯

æ¥ä¸‹æ¥å®ç°è¯»å–ç›®æ ‡ç”¨æˆ·çŠ¶æ€ä¿¡æ¯çš„åŠŸèƒ½ï¼Œäº¦æ˜¯æœ¬åº”ç”¨æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼š

```python
from discord.ext import tasks

class MyClient(discord.Client):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.recipient = None
        self.queried_activities = []

    async def setup_hook(self) -> None:
        self.task_query_activities.start()

    @tasks.loop(seconds=5)
    def task_query_activities(self):
        if self.recipient is None:
            channelId = int(os.getenv("DISCORD_CHANNEL_ID"))
            channel = self.get_channel(channelId)
            self.recipient = channel.recipient
            print(f"âœ… Set recipient to {self.recipient}.")

        relation = self.get_relationship(self.recipient.id)
        self.queried_activities = [
            activity.to_dict() for activity in relation.activities
        ]
        print(
            f"âœ… Updated activities for user {self.recipient}: {self.queried_activities}"
        )

    @task_query_activities.before_loop
    async def before_task_query_activities(self):
        await self.wait_until_ready()
```

ç¬”è€…ç¿»é˜… `discord.py-self` çš„æ–‡æ¡£è‰¯ä¹…ï¼Œç»ˆäºæ‰¾åˆ°äº† `get_relationship(user_id)` æ–¹æ³•ï¼Œå¯ä»¥è·å–å½“å‰ç™»å½•ç”¨æˆ·ï¼ˆå­è´¦å·ï¼‰ä¸æŒ‡å®šç”¨æˆ·ï¼ˆä¸»è´¦å·ï¼‰çš„å¥½å‹å…³ç³»ã€‚å¥½å‹å…³ç³»å¦‚ä½•å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯è¿™ä¸ªæ¥å£çš„è¿”å›å€¼é‡Œå›Šæ‹¬äº†æŒ‡å®šç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç¬”è€…è®©æœåŠ¡æ¯äº”ç§’æ‰§è¡Œæ­¤æ–¹æ³•å¹¶å¾—åˆ°æœ€æ–°çš„çŠ¶æ€ä¿¡æ¯ï¼›ç¯å¢ƒå˜é‡ `DISCORD_CHANNEL_ID` æ˜¯ Bot ä¸ä¸»è´¦å·çš„ç§èŠé¢‘é“ IDï¼ŒåŒæ ·å¯ä»¥é€šè¿‡æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ‰¾åˆ°ç½‘ç»œè¯·æ±‚æ‰¾åˆ°ã€‚

Discord å®˜æ–¹æ–‡æ¡£é‡Œå¥½åƒæœ‰æåˆ° API è¯·æ±‚é™åˆ¶æ˜¯æ¯åˆ†é’Ÿ 120 æ¬¡ï¼Œç¬”è€…åœ¨è¿™é‡Œè®¾ç½®ä¸ºäº†æ¯ 5 ç§’è¯·æ±‚ 1 æ¬¡ï¼Œåº”è¯¥ç®— Bot æœåŠ¡ç•Œçš„è‰¯å¿ƒå§ï¼Œè¯·ä¸è¦å°ç¦æˆ‘çš„è´¦å·ï¼

è¿è¡Œåº”ç”¨ï¼Œé¡ºåˆ©æ‰“å°ç¬”è€… Discord ä¸»è´¦å·çš„çŠ¶æ€ä¿¡æ¯å¦‚ä¸‹ï¼š

```plaintext
âœ… Updated activities for user username#0: [{'state': 'Workspace: discord-activity-sender', 'details': 'Editing main.py', 'timestamps': {'start': 1763218441894}, 'assets': {'small_text': 'Visual Studio Code', 'small_image': '1359299466493956258', 'large_text': 'Editing a PYTHON file', 'large_image': '1359299282380918886'}, 'flags': 0, 'session_id': 'some_session_id', 'type': 0, 'name': 'Visual Studio Code', 'application_id': 383226320970055681, 'buttons': ['View Repository']}, {'state': 'ğŸ¤ é™ˆå¥•è¿…\u200b', 'details': 'â–¶ï¸ çƒ­å¸¦é›¨æ—\u200b', 'timestamps': {'staart': 1763223056699, 'end': 1763223314779}, 'assets': {'small_text': 'Tencent QQMusic', 'small_image': '1431733810025988256', 'large_text': 'ğŸ’¿ The Easy Ride\u200b', 'large_image': 'mp:external/KZjIWMaOSvXCbL1zzLTbVk50JQ-usSu1AUFI8q1e-P8/%3Fmax_age%3D2592000/https/y.gtimg.cn/music/photo_new/T002R500x500M000002rHV981wx55S_3.jpg'}, 'flags': 0, 'session_id': 'some_session_id', 'type': 2, 'name': 'Tencent QQ Music', 'application_id': 1431607752945434655, 'buttons': ['ğŸ§ Listen', 'ğŸ” View App on GitHub']}]
```

â€¦â€¦ç„¶ååœ¨ Self-Bot æœåŠ¡æŒç»­è¿è½¬ä¸‰å¤©åï¼ŒDiscord å°ç¦äº†ç¬”è€…å¯æ€œçš„å­è´¦å·ï¼š

![nooooo](./display-my-discord-status/nooooo.png)

è¿˜å¥½å¼€å‘çš„æ—¶å€™å¤šæƒ³äº†æƒ³ï¼Œæ²¡æœ‰ç”¨ä¸»è´¦å·è·‘æœåŠ¡ï¼Œä¾¥å¹¸ä¾¥å¹¸ã€‚

å’³å’³ï¼Œé‚£ä¹ˆæ€»ä¹‹ï¼Œè¿è¡Œè½®è¯¢ä»»åŠ¡æ¥è·å–æŒ‡å®šè´¦å·çš„çŠ¶æ€ä¿¡æ¯ä¼šè¢« Discord é£æ§å¹¶å°ç¦ï¼Œå°±åº”è¯¥è€ƒè™‘æ›´å¥åº·ï¼Œæ›´åˆä½œçš„æ–¹å¼æ¥å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚

å®é™…ä¸Šï¼Œåœ¨åå°å¹¶ä¸éœ€è¦æ—¶æ—¶åˆ»åˆ»è¯»å–å¹¶å­˜æ¡£ä¸€ä»½ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ï¼Œåªéœ€è¦åœ¨æ¥å£è¯·æ±‚æ—¶ï¼Œè¿”å›ç¼“å­˜çš„çŠ¶æ€ä¿¡æ¯å³å¯ã€‚å¦‚æœç¼“å­˜è¿‡æœŸï¼Œæ‰è°ƒç”¨ Discord æ¥å£è¯»å–ã€‚è¿™æ ·ä¸€æ¥ï¼Œç›¸æ¯”æ˜ç›®å¼ èƒ†æ¯äº”ç§’è¯·æ±‚ä¸€æ¬¡æ¥å£ï¼Œè¢«è¯†åˆ«é£æ§çš„é£é™©ä¼šå¤§å¤§é™ä½ã€‚

æ–°å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š

```python
import time

class MyClient(discord.Client):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self._recipient = None
        self._queried_activities = []
        self._last_query_time = float(0)
        self._activity_cache_duration = float(30)

    @property
    def queried_activities(self):
        # å¦‚æœç¼“å­˜æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›ç¼“å­˜çš„çŠ¶æ€ä¿¡æ¯
        if time.time() - self._last_query_time < self._activity_cache_duration:
            print(
                f"â„¹ï¸ Return cached activities for user {self._recipient}: {self._queried_activities}"
            )
            return self._queried_activities

        # ...çœç•¥è·å– self._recipient çš„ä»£ç 

        relation = self.get_relationship(self._recipient.id)
        self._queried_activities = [
            activity.to_dict() for activity in relation.activities
        ]
        # è®¾ç½®æ–°çš„ç¼“å­˜æ—¶é—´
        self._last_query_time = time.time()
        print(
            f"âœ… Update activities for user {self._recipient}: {self._queried_activities}"
        )

        return self._queried_activities
```

å¦å¤–ï¼Œç¬”è€…å‘ç° Discord å®˜æ–¹æä¾›çš„ [Gateway](https://discord.com/developers/docs/events/gateway#tracking-state) æ–¹æ¡ˆå¯ä»¥è¿½è¸ªç”¨æˆ·çš„çŠ¶æ€æ›´æ–°äº‹ä»¶ï¼Œä»è€Œå®æ—¶è·å–çŠ¶æ€ä¿¡æ¯ï¼Œæ˜¯å®˜æ–¹è®¤å¯çš„è§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯å®ƒçš„å®ç°ç»†èŠ‚é¢‡å¤šï¼Œä¸ç¬¦åˆç¬”è€…èŠ±å°æ—¶é—´åŠå¤§äº‹æƒ…çš„åˆè¡·ï¼Œå› è€Œç•™å¾…æ—¥åï¼Œå¦‚æœåŸºäºç¼“å­˜çš„ Self Bot è¿˜æ˜¯è¢«å°ç¦çš„è¯ï¼Œå°±é€‰æ‹©å®˜æ–¹çš„ Gateway æ–¹æ¡ˆå’Œå¹³ç»Ÿä¸€å§ã€‚

### å¼€æ”¾ API æœåŠ¡

æœ€æœ«ï¼ŒåŸºäº FastAPI å¼€æ”¾æ¥å£ `GET /activity` ä¾›å‰ç«¯è°ƒç”¨ï¼š

```python
@app.get("/activity")
def activity():
    return client.queried_activities
```

å¯åŠ¨åº”ç”¨ï¼Œè®¿é—®æœ¬åœ°æ¥å£åœ°å€å¦‚ `localhost:28800/activity`ï¼Œå°±èƒ½çœ‹åˆ°æŒ‡å®š Discord è´¦å·çš„çŠ¶æ€ä¿¡æ¯äº†ï¼

æ¥ä¸‹æ¥ï¼Ÿè¿˜ä¸å¿«æŠŠåº”ç”¨éƒ¨ç½²åˆ°è‡ªå·±èƒ½è®¿é—®åˆ° Discord çš„æœåŠ¡å™¨ä¸Šï¼Œç„¶åå»æ“å‰ç«¯ä»£ç ï¼

æ‚¨å¯ä»¥åœ¨ä»“åº“ [`LolipopJ/discord-activity-sender`](https://github.com/LolipopJ/discord-activity-sender) æ‰¾åˆ°å®Œæ•´çš„é¡¹ç›®ä»£ç ã€‚

## ä¸°å¯Œè‡ªå·±çš„ Discord çŠ¶æ€

å¯¹äºåŸç”Ÿä¸æ”¯æŒå…±äº«çŠ¶æ€ç»™ Discord çš„è½¯ä»¶ï¼Œä¹Ÿå¯ä»¥æœç´¢ç›¸å…³çš„ RPC è½¯ä»¶æˆ–æ’ä»¶æ¥å°†å®ƒä»¬çš„çŠ¶æ€ä¸»åŠ¨æ¨é€ç»™ Discordã€‚ç¬”è€…å¸¸ç”¨çš„æœ‰å¦‚ä¸‹ä¸¤æ¬¾ã€‚

### å…±äº« QQ éŸ³ä¹æ’­æ”¾çŠ¶æ€

Discord åŸç”Ÿæ”¯æŒè¯»å– Spotify ç­‰å›½å¤–æµè¡ŒéŸ³ä¹è½¯ä»¶çš„æ’­æ”¾çŠ¶æ€ï¼Œä½†ä¸æ”¯æŒè¯»å–ç¬”è€…å¸¸ç”¨çš„ QQ éŸ³ä¹çš„æ’­æ”¾çŠ¶æ€ã€‚å¼€æºè½¯ä»¶ [NetEase-Cloud-Music-DiscordRPC](https://github.com/Kxnrl/NetEase-Cloud-Music-DiscordRPC) è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œè®¾ç½®å®ƒå¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼Œå³å¯å°† QQ éŸ³ä¹çš„æ’­æ”¾çŠ¶æ€åŒæ­¥åˆ° Discord ä¸Šã€‚å½“ç„¶ï¼Œè¿™æ¬¾è½¯ä»¶æœ¬èº«æ˜¯ä¸ºè¯»å–ç½‘æ˜“äº‘æ’­æ”¾çŠ¶æ€æ‰€è®¾è®¡å¼€å‘çš„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ç½‘æ˜“äº‘éŸ³ä¹ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥åŒæ­¥æ’­æ”¾çŠ¶æ€ã€‚

![qq music status](./display-my-discord-status/qq-music-status.png)

æ’°å†™æœ¬æ–‡æ—¶ï¼Œè¯¥å¼€æºè½¯ä»¶å·²ç»å°†è¿‘ä¸€å¹´æ²¡æœ‰æ›´æ–°ç»´æŠ¤ï¼Œä¸€äº›å½±å“ä½“éªŒçš„é—®é¢˜ä¹ŸäºŸå¾…è§£å†³ï¼Œä¾‹å¦‚æ­£åœ¨æ’­æ”¾çš„éŸ³ä¹åç§°è¿‡é•¿ä¼šå‡ºç°æŠ¥é”™ã€‚å¹¸äºæœ‰[ç¤¾åŒºè´¡çŒ®çš„ç‰ˆæœ¬](https://github.com/kriYamiHikari/Music-DiscordRPC)åœ¨æŒç»­æ”¹è¿›ï¼Œç¬”è€…å¦‚ä»Šä¹Ÿæ˜¯ç”¨çš„è¯¥ç‰ˆæœ¬å®ç°éŸ³ä¹æ’­æ”¾çŠ¶æ€çš„åŒæ­¥ã€‚

### å…±äº« VSCode ç¼–è¾‘çŠ¶æ€

VSCode ä½•å°ä¸æ˜¯ä¸€æ¬¾é¢å‘ç¨‹åºå‘˜çš„ç›Šæ™ºæ¸¸æˆï¼Œæ’ä»¶ [Discord Presence](https://marketplace.visualstudio.com/items?itemName=icrawl.discord-vscode) å¯ä»¥å®ç°å°†å½“å‰ç¼–è¾‘æ–‡ä»¶ä¿¡æ¯ä¸ç¼–è¾‘æ—¶é•¿åŒæ­¥åˆ° Discord ä¸Šçš„åŠŸèƒ½ã€‚

![vscode status](./display-my-discord-status/vscode-status.png)
